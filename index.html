<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/1.0.26/vue.min.js"></script>
    <script type="text/javascript" src="example.json"></script>
</head>
<body>



    <?php
    if(isset($_POST["send"])) {
    	$phone = htmlspecialchars($_POST["phone"]);
    	$to = 'Artur69Karmov@gmail.com';
        $message = "betonbasis.ru";
    	$error_from = "";
    	if(!preg_match('/\d{9}/',$phone)) {
    		$error_from = "Введите корректный номер телефона!";
    		$is_error = true;
    	}
    	if(!$is_error) {
    		mail($to, "Заказ услуги с сайта", $message);
    	}
    }
    ?>



    <div class="delivery container">

        <div class="delivery__calc">
            <div id="app">
                <p class="delivery__title">ДОСТАВКА ДО НАСЕЛЕННОГО ПУНКТА</p>
                <div class="delivery__input">
                    <input type="text" class="delivery__input-value"  v-model="input" v-on:input="myinput" autofocus>
                    <img src="clear.png" alt="" v-on:click="clear">
                </div>

                <ul class="delivery__list">
                    <li v-for="item in userData | filterBy input" class="delivery__item" v-on:click="element_click" data-name='{{item.name}}' data-price='{{item.price}}'>{{item.name}}</li>
                </ul>
                <div class="delivery__result">
                    <div class="delivery__adress">
                        <div class="delivery__adress-item delivery__from" v-if='false'>
                            <p>Адрес завода</p>
                            <span>ТАЛЛИНСКОЕ ШОССЕ 153, САНКТ-ПЕТЕРБУРГ</span>
                        </div>
                        <div class="delivery__adress-item delivery__to">
                            <img src='location2.png' alt='' />
                            <p>Адрес доставки</p>
                            <span class="delivery__to-value"></span>
                        </div>
                    </div>
                    <div class="delivery__price">
                        <div class="delivery__total-price">
                            <img src='cube.png' alt='' />
                            <p>Цена за м3</p>
                            <span class="delivery__price-value"></span>
                        </div>
                        <div class="delivery__min-price">
                            <img src='delivery.png' alt='' />
                            <p>Мин. цена доставки</p>
                            <span class="delivery__price-value2"></span>
                        </div>
                    </div>
                </div>
                <div class="order">
                    <div class="phone delivery__phone">
                        <img src="phone.png" alt="" class="phone__img">
                        <p lass="phone__text">ВАШ НОМЕР ТЕЛЕФОНА</p>
                        <span style="color:red"><?php echo $error_from ?></span>
                    </div>

                    <form action="" class="delivery__form" method="post">
                        <input type="tel" class="delivery__phone" name="phone" placeholder="Номер телефона:" value="">
                        <button type="submit" name="send">Заказать</button>
                    </form>
                </div>
            </div>
        </div>
    </div>



    <script>
        var dataURL = 'example.json';
        var app = new Vue({
          el: '#app',
          data: {
            input: '',
            userData: []
        },
        methods: {
          myinput: function() {
             var delivery__list = document.querySelector('.delivery__list');
             if(document.querySelector('.delivery__item')) {
                  delivery__list.style.display = "flex";
             }
         },
         clear: function() {
            document.querySelector('.delivery__input-value').value = "";
            document.querySelector('.delivery__list').style.display = "none";
         },
         element_click: function(e) {
             var this_price = e.target.attributes['data-price'].value;
             document.querySelector('.delivery__price-value').innerText = this_price;
             document.querySelector('.delivery__price-value2').innerText = this_price * 7;
             document.querySelector('.delivery__input-value').value = e.target.attributes['data-name'].value;
             document.querySelector('.delivery__to-value').innerText = e.target.attributes['data-name'].value;
         }
      }
        })

        document.addEventListener('click',function(){
            document.querySelector('.delivery__list').style.display = "none";
        });


        function loadFile(url) {
            return new Promise(function(resolve, reject) {
                var xhr = new XMLHttpRequest();

                xhr.open('GET', url);
                xhr.responseType = 'json';
                xhr.send();
                xhr.addEventListener('load', function () {
                    if(xhr.status >= 400) {
                        reject(xhr.status);
                    } else {
                        console.log(xhr.response);
                        console.log(xhr.responseText);
                        resolve(xhr.response)
                    }
                });
            });
        }

        loadFile('example.json');
    </script>

</body>
</html>
